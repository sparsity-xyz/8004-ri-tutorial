FROM python:3.12-slim

RUN apt-get update && apt-get install -y

# Build arguments for Nitro enclave configuration
ARG VSOCK=false
ARG DNS=true
ARG HTTP=false
ARG PERSISTENT_KEY=false
ARG APP_ID
ARG KMS_KEY_ID
ARG BUCKET_NAME
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_SESSION_TOKEN
ARG AWS_DEFAULT_REGION

ENV VSOCK=${VSOCK}
ENV DNS=${DNS}
ENV HTTP=${HTTP}
ENV PERSISTENT_KEY=${PERSISTENT_KEY}
ENV APP_ID=${APP_ID}
ENV KMS_KEY_ID=${KMS_KEY_ID}
ENV BUCKET_NAME=${BUCKET_NAME}
ENV AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
ENV AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
ENV AWS_SESSION_TOKEN=${AWS_SESSION_TOKEN}
ENV AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION}

WORKDIR /app
COPY . .

RUN pip install -r requirements.txt

CMD ["/usr/local/bin/python3", "/app/main.py"] 